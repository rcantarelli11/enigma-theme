{%- liquid
  echo 'section-featured-links.css' | asset_url | stylesheet_tag
  render 'inline-scripts', script_name: 'featured-links'
  render 'inline-scripts', script_name: 'visibility-watcher'

  capture heading_size_class
    render 'settings-text-size', type: 'heading', size: section.settings.heading_font_size
  endcapture

  # This is an exception to having 2 font sizes (heading and body)
  # Here, we use the heading scale for both heading and body fonts
  capture link_size_class
    render 'settings-text-size', type: 'heading', size: section.settings.link_font_size
  endcapture

  capture image_sizes
    render 'get-tile-image-sizes', section_width: section.settings.width, desktop_image_width: section.settings.image_showcase_width, tablet_image_width: section.settings.image_showcase_width, breakpoint_min: 'tablet'
  endcapture

  capture mobile_image_sizes
    render 'get-tile-image-sizes', breakpoint_max: 'mobile', image_width_unit: 'px', mobile_image_width: 150
  endcapture

  capture separator
    case section.settings.link_inline_style_separator
      when 'comma'
        echo ',&nbsp;'
      when 'dash'
        echo '&nbsp;&mdash;&nbsp;'
      else
        echo '&nbsp;/&nbsp;'
    endcase
  endcapture
%}

{%- capture separator_element -%}
  <span class="featured-links__separator {{ link_size_class }} ff-{{ section.settings.link_text_style }}">
    {{- separator -}}
  </span>
{%- endcapture -%}

{%- capture period_element -%}
  <span class="featured-links__separator featured-links__separator--period {{ link_size_class }} ff-{{ section.settings.link_text_style }}">
    {{- "." -}}
  </span>
{%- endcapture -%}

{%- capture links_content -%}
  <div class="featured-links__links-wrapper">
    {% render 'section-header', section: section, animate_heading: true, include_animation_assets: false, size_class: heading_size_class %}

    <div
      class="
        featured-links__links
        featured-links__links--display-style-{{ section.settings.link_display_style }}
        featured-links__links--display-style-mobile-{{ section.settings.link_display_style_mobile }}
      "
    >
      {%- for block in section.blocks -%}
        <div class="featured-links__link-item {{ link_size_class }}">
          {%- if section.settings.link_display_style_mobile == 'stacked' and section.settings.enable_mobile_thumbnails -%}
            {%- liquid
              capture placeholder_suffix
                cycle '1', '2', '3', '4'
              endcapture

              capture placeholder_name
                echo 'collection-apparel-[[ps]]' | replace: '[[ps]]', placeholder_suffix
              endcapture

              # Thumbnail img width can range from 32-127px based on the aspect ratio
              assign src_set_width_values = '50,100,150,200,260'
            -%}

            {%- render 'image',
              image: block.settings.link_image,
              aspect_ratio: section.settings.image_showcase_aspect_ratio,
              class: "featured-links__link-thumbnail",
              focal_point: 'image-presentation',
              include_placeholder: true,
              placeholder_name: placeholder_name,
              placeholder_natural_fallback_ratio: 'square',
              sizes: mobile_image_sizes,
              src_set_width_values: src_set_width_values,
              load_animation_effect: 'blur'
            -%}
          {%- endif -%}

          <div class="featured-links__link_wrapper">
            <a
              href="{{ block.settings.link_url }}"
              class="
                featured-links__link
                ff-{{ section.settings.link_text_style }}
                {{ link_size_class }}
                {% if block.settings.link_underline %} featured-links__link--underlined{% endif %}
              "
              data-index="{{ forloop.index }}"
              js-featured-links-link
              data-block-id="{{  block.id }}"
              {{  block.shopify_attributes }}
            >
              {%- if block.settings.link_underline -%}
                <span>
              {%- endif -%}

              {{- block.settings.link_label -}}

              {%- if section.settings.link_show_product_counts -%}
                {%- if block.settings.link_url.type == 'collection_link' -%}
                  <sup>{{- block.settings.link_url.object.products_count -}}</sup>
                {%- elsif block.settings.link_url.type == 'catalog_link' and block.settings.link_url.url == '/collections/all' -%}
                  <sup>{{- collections['all'].products_count -}}</sup>
                {%- endif -%}
              {%- endif -%}

              {%- if block.settings.link_underline -%}
                </span>
              {%- endif -%}
            </a>

            {%- liquid
              unless forloop.last
                echo separator_element
              else
                if section.settings.link_inline_style_separator == 'comma'
                  echo period_element
                endif
              endunless
            -%}
          </div>
        </div>
      {% endfor %}
    </div>

    {%- if section.settings.button_label != blank -%}
      {% render 'button', label: section.settings.button_label, link: section.settings.button_url, button_style: section.settings.button_style %}
    {%- endif -%}
  </div>
{%- endcapture -%}

{%- capture image_showcase -%}
  {%- if section.settings.image_showcase_enabled -%}
    <div class="featured-links__image-showcase">
      {%- for block in section.blocks -%}
        {%- liquid
          capture placeholder_suffix
            cycle '1', '2', '3', '4'
          endcapture

          capture placeholder_name
            echo 'collection-apparel-[[ps]]' | replace: '[[ps]]', placeholder_suffix
          endcapture
        -%}

        <div class="featured-links__link-image-wrapper" data-index="{{ forloop.index }}" js-featured-links-image>
          {%- render 'image',
            image: block.settings.link_image,
            aspect_ratio: section.settings.image_showcase_aspect_ratio,
            class: 'featured-links__link-image',
            focal_point: 'image-presentation',
            include_placeholder: true,
            placeholder_name: placeholder_name,
            placeholder_natural_fallback_ratio: 'square',
            sizes: image_sizes,
            src_set_type: 'grid',
            prioritize_loading: true,
            animate: false
          -%}
        </div>
      {%- endfor -%}

      {%- if section.settings.default_image -%}
        <div class="featured-links__link-image-wrapper current" data-index="0" js-featured-links-image>
          {%- render 'image',
            image: section.settings.default_image,
            aspect_ratio: section.settings.image_showcase_aspect_ratio,
            class: 'featured-links__link-image',
            focal_point: 'image-presentation',
            include_placeholder: true,
            placeholder_name: 'collection-apparel-1',
            placeholder_natural_fallback_ratio: 'square',
            sizes: image_sizes,
            load_animation_effect: 'blur'
          -%}
        </div>
      {%- endif -%}
    </div>
  {%- endif -%}
{%- endcapture -%}

<featured-links
  class="section featured-links"
  style="
    {% render 'settings-section-padding' %}
    {% render 'color-scheme-to-vars', color_scheme: section.settings.color_scheme %}
    --image-showcase-width: {{ section.settings.image_showcase_width }}%;
    {%- # We add 0.1 to the line height to account for the underline -%}
    --link-line-height-em: {{ section.settings.link_line_height | plus: 0.1 }}em;
  "
>
  <div class="section-inner section-inner--width-{{ section.settings.width }}">
    {%- liquid
      if section.settings.image_showcase_position == 'left'
        echo image_showcase
        echo links_content
      else
        echo links_content
        echo image_showcase
      endif
    -%}
  </div>
</featured-links>

{% schema %}
{
  "name": "t:sections.featured_links.name",
  "tag": "section",
  "class": "featured-links",
  "disabled_on": {
    "groups": [
      "header",
      "custom.overlay"
    ]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:shared.settings.color_scheme.label",
      "default": "scheme_1"
    },
    {
      "type": "header",
      "content": "t:shared.settings.section_header.header.content"
    },
    {
      "id": "section_header_heading",
      "type": "text",
      "label": "t:shared.settings.section_header.heading.label",
      "default": "t:sections.featured_links.settings.header.heading.default"
    },
    {
      "type": "range",
      "id": "heading_font_size",
      "min": 1,
      "max": 8,
      "step": 1,
      "label": "t:shared.settings.text_size.label_heading",
      "info": "t:shared.settings.text_size.info",
      "default": 1
    },
    {
      "id": "section_header_heading_tag",
      "type": "select",
      "label": "t:shared.settings.heading_tag.label",
      "options": [
        {
          "value": "h1",
          "label": "H1"
        },
        {
          "value": "h2",
          "label": "H2"
        },
        {
          "value": "h3",
          "label": "H3"
        },
        {
          "value": "h4",
          "label": "H4"
        },
        {
          "value": "h5",
          "label": "H5"
        },
        {
          "value": "h6",
          "label": "H6"
        }
      ],
      "info": "t:shared.settings.heading_tag.info",
      "default": "h2"
    },
    {
      "type": "header",
      "content": "t:sections.featured_links.settings.links.header.content"
    },
    {
      "type": "select",
      "id": "link_text_style",
      "label": "t:sections.featured_links.settings.links.link_text_font.label",
      "options": [
        {
          "value": "heading",
          "label": "t:shared.settings.typography.text_style.options.heading"
        },
        {
          "value": "body",
          "label": "t:shared.settings.typography.text_style.options.body"
        }
      ],
      "default": "heading"
    },
    {
      "type": "range",
      "id": "link_font_size",
      "min": 1,
      "max": 8,
      "step": 1,
      "label": "t:shared.settings.text_size.label_link",
      "info": "t:shared.settings.text_size.info",
      "default": 6
    },
    {
      "type": "range",
      "id": "link_line_height",
      "label": "t:sections.featured_links.settings.links.link_line_height.label",
      "min": 1,
      "max": 2,
      "step": 0.1,
      "default": 1.3
    },
    {
      "type": "select",
      "id": "link_display_style",
      "label": "t:sections.featured_links.settings.links.link_desktop_display_style.label",
      "options": [
        {
          "value": "inline",
          "label": "t:sections.featured_links.settings.links.link_desktop_display_style.options.inline"
        },
        {
          "value": "stacked",
          "label": "t:sections.featured_links.settings.links.link_desktop_display_style.options.stacked"
        }
      ],
      "default": "inline"
    },
    {
      "type": "select",
      "id": "link_display_style_mobile",
      "label": "t:sections.featured_links.settings.links.link_mobile_display_style.label",
      "options": [
        {
          "value": "inline",
          "label": "t:sections.featured_links.settings.links.link_mobile_display_style.options.inline"
        },
        {
          "value": "stacked",
          "label": "t:sections.featured_links.settings.links.link_mobile_display_style.options.stacked"
        }
      ],
      "default": "stacked"
    },
    {
      "type": "select",
      "id": "link_inline_style_separator",
      "label": "t:sections.featured_links.settings.links.link_inline_style_separator.label",
      "info": "t:sections.featured_links.settings.links.link_inline_style_separator.info",
      "options": [
        {
          "value": "comma",
          "label": "t:sections.featured_links.settings.links.link_inline_style_separator.options.comma"
        },
        {
          "value": "dash",
          "label": "t:sections.featured_links.settings.links.link_inline_style_separator.options.dash"
        },
        {
          "value": "slash",
          "label": "t:sections.featured_links.settings.links.link_inline_style_separator.options.slash"
        }
      ],
      "default": "comma"
    },
    {
      "type": "checkbox",
      "id": "link_show_product_counts",
      "label": "t:sections.featured_links.settings.links.link_show_product_counts.label",
      "default": false
    },
    {
      "type": "header",
      "content": "t:sections.featured_links.settings.button.header.content"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "t:sections.featured_links.settings.button.button_url.label"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "t:sections.featured_links.settings.button.button_label.label",
      "info": "t:sections.featured_links.settings.button.button_label.info",
      "default": "t:sections.featured_links.settings.button.button_label.default"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "t:shared.settings.button_style.label",
      "options": [
        {
          "value": "solid",
          "label": "t:shared.settings.button_style.options.solid"
        },
        {
          "value": "outline",
          "label": "t:shared.settings.button_style.options.outline"
        },
        {
          "value": "text",
          "label": "t:shared.settings.button_style.options.text"
        }
      ],
      "default": "solid"
    },
    {
      "type": "header",
      "content": "t:sections.featured_links.settings.image_showcase.header.content"
    },
    {
      "type": "checkbox",
      "id": "image_showcase_enabled",
      "label": "t:sections.featured_links.settings.image_showcase.enable_image_showcase.label",
      "info": "t:sections.featured_links.settings.image_showcase.enable_image_showcase.info",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "default_image",
      "label": "t:sections.featured_links.settings.image_showcase.default_image.label",
      "info": "t:sections.featured_links.settings.image_showcase.default_image.info"
    },
    {
      "type": "range",
      "id": "image_showcase_width",
      "label": "t:sections.featured_links.settings.image_showcase.image_width.label",
      "min": 40,
      "max": 60,
      "step": 1,
      "unit": "%",
      "default": 40
    },
    {
      "type": "select",
      "id": "image_showcase_position",
      "label": "t:sections.featured_links.settings.image_showcase.image_position.label",
      "options": [
        {
          "value": "left",
          "label": "t:sections.featured_links.settings.image_showcase.image_position.options.left"
        },
        {
          "value": "right",
          "label": "t:sections.featured_links.settings.image_showcase.image_position.options.right"
        }
      ],
      "default": "right"
    },
    {
      "type": "select",
      "id": "image_showcase_aspect_ratio",
      "label": "t:shared.settings.aspect_ratio.labels.default",
      "options": [
        {
          "value": "portrait",
          "label": "t:shared.settings.aspect_ratio.options.portrait"
        },
        {
          "value": "portrait-alt",
          "label": "t:shared.settings.aspect_ratio.options.portrait_alt"
        },
        {
          "value": "square",
          "label": "t:shared.settings.aspect_ratio.options.square"
        },
        {
          "value": "landscape-alt",
          "label": "t:shared.settings.aspect_ratio.options.landscape_alt"
        },
        {
          "value": "landscape",
          "label": "t:shared.settings.aspect_ratio.options.landscape"
        },
        {
          "value": "landscape-wide",
          "label": "t:shared.settings.aspect_ratio.options.landscape_wide"
        },
        {
          "value": "landscape-ultrawide",
          "label": "t:shared.settings.aspect_ratio.options.landscape_ultrawide"
        }
      ],
      "info": "t:sections.featured_links.settings.image_showcase.aspect_ratio.info",
      "default": "portrait-alt"
    },
    {
      "type": "checkbox",
      "id": "enable_mobile_thumbnails",
      "label": "t:sections.featured_links.settings.image_showcase.enable_mobile_thumbnails.label",
      "info": "t:sections.featured_links.settings.image_showcase.enable_mobile_thumbnails.info",
      "default": true
    },
    {
      "type": "header",
      "content": "t:shared.settings.section_settings.header.content"
    },
    {
      "type": "select",
      "id": "width",
      "label": "t:shared.settings.section_settings.width.label",
      "options": [
        {
          "value": "page-width",
          "label": "t:shared.settings.section_settings.width.options.page_width"
        },
        {
          "value": "full-width-padded",
          "label": "t:shared.settings.section_settings.width.options.full_width_padded_simplified_language"
        }
      ],
      "info": "t:shared.settings.section_settings.width.info",
      "default": "full-width-padded"
    },
    {
      "type": "range",
      "id": "top_padding",
      "label": "t:shared.settings.section_settings.top_padding.label",
      "min": 0,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "bottom_padding",
      "label": "t:shared.settings.section_settings.bottom_padding.label",
      "min": 0,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 60
    }
  ],
  "blocks": [
    {
      "type": "link",
      "name": "t:sections.featured_links.blocks.link.name",
      "settings": [
        {
          "type": "url",
          "id": "link_url",
          "label": "t:sections.featured_links.blocks.link.settings.url.label"
        },
        {
          "type": "text",
          "id": "link_label",
          "label": "t:sections.featured_links.blocks.link.settings.label.label"
        },
        {
          "type": "image_picker",
          "id": "link_image",
          "label": "t:sections.featured_links.blocks.link.settings.image.label"
        },
        {
          "type": "checkbox",
          "id": "link_underline",
          "label": "t:sections.featured_links.blocks.link.settings.underline.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.featured_links.presets.name",
      "blocks": [
        {
          "type": "link",
          "settings": {
            "link_label": "Tops"
          }
        },
        {
          "type": "link",
          "settings": {
            "link_label": "Bottoms"
          }
        },
        {
          "type": "link",
          "settings": {
            "link_label": "Footwear"
          }
        },
        {
          "type": "link",
          "settings": {
            "link_label": "Accessories"
          }
        },
        {
          "type": "link",
          "settings": {
            "link_label": "Sale"
          }
        }
      ]
    }
  ]
}
{% endschema %}
