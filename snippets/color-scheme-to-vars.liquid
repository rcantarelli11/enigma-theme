{%- liquid
  comment
    Renders CSS variables for each color setting in a color scheme.

    Required parameters:
      - color_scheme: { Object } The color scheme to extract variables from.

    Optional parameters:
      - css_vars: { String } A comma-separated list of color scheme CSS variables to output. If a
          value is supplied, then only the listed variables are output. Variables shouldn't include
          the '--color-' prefix, alpha-modified variables need to be explicitly listed, and there
          should be no spaces between variables. See the list of variables below.
      - prefix: { String } A prefix to be applied before each variable name. For example, if we
          have a variable of '--color-background' and a prefix of 'modal', then the resulting variable
          name would be '--color-modal-background'.

    Color scheme variables (Liquid setting | CSS var):
      - General
        - background | --color-background
        - background_gradient | --color-background-gradient
        - text | --color-text
          - Also has alpha variations in CSS (--color-text-alpha-XX):
            - 05, 08, 10, 20, 30, 40, 50, 60, 70, 80, 90
        - lines_and_borders | --color-lines-and-borders
          - Also has alpha variations in CSS (--color-lines-and-borders-alpha-XX)
            - 40, 50, 60
        - accent | --color-accent
        - accent_foreground | --color-accent-foreground
      - Solid buttons
        - solid_button_background | --color-solid-button-background
        - solid_button_text | --color-solid-button-text
      - Outline buttons
        - outline_button_background | --color-outline-button-background
        - outline_button_text_and_border | --color-outline-button-text-and-border
          - Also has alpha variations in CSS (--color-outline-button-text-and-border-alpha-XX):
            - 10, 20, 30, 40, 50
      - Buttons with icon
        - icon_button_background | --color-icon-button-background
         - Also has alpha variations in CSS (--color-icon-button-background-alpha-XX):
            - 40, 60
        - icon_button_foreground | --color-icon-button-foreground
  endcomment

  assign output_all_variables = false

  if css_vars != blank
    # Convert handleized CSS vars to snake-case setting vars
    assign setting_ids = css_vars | replace: '-', '_' | split: ','
  else
    assign setting_ids = color_scheme.settings
    assign output_all_variables = true
  endif

  for setting_id in setting_ids
    # CSS vars should be handleized, so we need to convert '_'s in the setting ID to '-'s
    # We also need to strip whitespace and remove alpha suffixes in case a variable list
    #   has been passed
    capture handleized_setting_id
      echo setting_id | replace: '_', '-' | strip | split: '-alpha' | first
    endcapture

    capture variable_name
      echo '--color-'

      if prefix
        echo prefix | append: '-'
      endif

      echo handleized_setting_id
    endcapture

    # If an alpha-modified variable has been passed, we need to access the unmodified
    # setting value
    if setting_id contains 'alpha'
      capture root_setting_id
        echo setting_id | split: '_alpha' | first | strip
      endcapture

      capture alpha_value
        echo setting_id | split: 'alpha_' | last
      endcapture

      assign setting_value = color_scheme.settings[root_setting_id]
    else
      assign setting_value = color_scheme.settings[setting_id]

      # prevent any carryover alpha values
      assign alpha_value = blank
    endif

    # Set blank background gradients to 'initial', which is the custom property version of being undefined.
    # Set any other blank settings to be transparent so that there's not
    #   just an empty value.
    if setting_value == blank
      if setting_id == 'background_gradient'
        assign setting_value = 'initial'
      else
        assign setting_value = 'rgba(0, 0, 0, 0)'
      endif
    endif

    # Unless this is specifically an alpha-modified variable that has been passed,
    # output variable declaration
    if output_all_variables or output_all_variables == false and alpha_value == blank
      echo '[[vn]]: [[vv]];' | replace: '[[vn]]', variable_name | replace: '[[vv]]', setting_value
    endif

    # If all variables are being output, create alpha variations for certain settings
    # Otherwise, if an alpha-modified value has been specified, create the dedicated alpha variation
    if output_all_variables
      case setting_id
        when 'text'
          render 'color-alpha-modified-vars', color_setting: setting_value, variable_name_base: variable_name, alpha_values: '05, 08, 10, 15, 20, 30, 40, 50, 60, 70, 80, 90'
        when 'lines_and_borders'
          render 'color-alpha-modified-vars', color_setting: setting_value, variable_name_base: variable_name, alpha_values: '40, 50, 60'
        when 'outline_button_text_and_border'
          render 'color-alpha-modified-vars', color_setting: setting_value, variable_name_base: variable_name, alpha_values: '10, 20, 30, 40, 50'
        when 'icon_button_background'
          render 'color-alpha-modified-vars', color_setting: setting_value, variable_name_base: variable_name, alpha_values: '40, 60, 80'
      endcase
    elsif alpha_value != blank
      render 'color-alpha-modified-vars', color_setting: setting_value, variable_name_base: variable_name, alpha_values: alpha_value
    endif

    unless forloop.last
      echo ' '
    endunless

    # Reset for the next setting
    assign alpha_value = blank
  endfor
-%}
