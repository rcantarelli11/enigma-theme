{%- comment -%}
  Enigma Product Card
  Usage: {% render 'enigma-product-card', product: product %}
{%- endcomment -%}

{%- liquid
  assign first_variant = product.selected_or_first_available_variant
  assign compare_price = first_variant.compare_at_price
  assign price = first_variant.price
  assign on_sale = false
  if compare_price > price
    assign on_sale = true
  endif
  assign sold_out = false
  unless first_variant.available
    assign sold_out = true
  endunless
-%}

<div class="enigma-product-card">
  <a href="{{ product.url }}" class="enigma-product-card__media" aria-label="{{ product.title }}">
    {%- if on_sale -%}
      <span class="enigma-product-card__badge">Sale</span>
    {%- elsif sold_out -%}
      <span class="enigma-product-card__badge" style="background: var(--text-muted);">Sold Out</span>
    {%- endif -%}

    {%- if product.featured_image != blank -%}
      {{ product.featured_image | image_url: width: 600 | image_tag: loading: 'lazy', sizes: '(min-width: 1024px) 25vw, (min-width: 768px) 33vw, 50vw' }}
    {%- else -%}
      {{ 'product-1' | placeholder_svg_tag: 'placeholder' }}
    {%- endif -%}

    {%- unless sold_out -%}
      <div class="enigma-product-card__quick-add">
        <form method="post" action="/cart/add" class="enigma-quick-add-form">
          <input type="hidden" name="id" value="{{ first_variant.id }}">
          <input type="hidden" name="quantity" value="1">
          <button type="submit" class="enigma-btn enigma-btn--primary enigma-btn--full">
            Add to Cart â€” {{ price | money }}
          </button>
        </form>
      </div>
    {%- endunless -%}
  </a>

  <a href="{{ product.url }}" class="enigma-product-card__info">
    <h3 class="enigma-product-card__title">{{ product.title }}</h3>
    <p class="enigma-product-card__price{% if on_sale %} enigma-product-card__price--sale{% endif %}">
      {%- if on_sale -%}
        <span style="text-decoration: line-through; color: var(--text-muted); margin-right: 0.5rem;">{{ compare_price | money }}</span>
      {%- endif -%}
      {{ price | money }}
    </p>
  </a>
</div>
