{%- liquid
  comment
    Renders the language and/or country (ie. currency) selector drawers.

    Required parameters:
      - id: { String } A unique string to be used for the localization form ID. Generally, should note where the
          form is being rendered (eg. "footer" or "header").
      - show_language_selector: { Boolean } Whether to show the language selector drawer.
      - show_country_selector: { Boolean } Whether to show the country selector drawer.
      - if show_country_selector == true
        - show_country_names: { Boolean } Whether to show the country names in the drawer.
        - show_country_flags: { Boolean } Whether to show the country flags in the drawer.
  endcomment

  echo 'component-localization-form.css' | asset_url | stylesheet_tag
  render 'inline-scripts', script_name: 'localization-form'

  assign trigger_classes = 'localization-drawer-trigger cluster btn btn--style-solid fs-body-75'

  capture checkmark_icon
    render 'icon-utility', icon: 'checkmark', width: 14, height: 14
  endcapture

  capture trigger_structure
    echo '<span class="t-overflow-ellipsis">[[trigger_content]]</span>'
    render 'icon-utility', icon: 'chevron-down-small', width: 10, height: 10
  endcapture
-%}

{%- if show_language_selector and localization.available_languages.size > 1 -%}
  {%- liquid
    assign id = 'language-' | append: id
    assign trigger_content = localization.language.endonym_name | capitalize

    capture language_trigger
      echo trigger_structure | replace: '[[trigger_content]]', trigger_content
    endcapture
  -%}

  {%- capture language_drawer_content -%}
    {%- render 'modal-close-button',
      form_class: 'mobile-language-drawer__close-button'
    -%}

    <div class="mobile-language-drawer__content" js-langauge-mobile-drawer>
      {% render 'localization-form-language',
        id: id,
        localization: localization,
        checkmark_icon: checkmark_icon
      %}
    </div>
  {%- endcapture -%}

  {%- render 'drawer',
    name: 'mobileLanguageDrawer',
    content: language_drawer_content,
    alignment: 'bottom',
    class: 'language-drawer'
  -%}

  <button class="{{ trigger_classes }}" js-language-drawer-trigger>
    {{ language_trigger }}
  </button>
{%- endif -%}

{%- if show_country_selector and show_language_selector %}
  <div class="navigation__cross-border-account-spacer"></div>
{% endif -%}

{%- if show_country_selector and localization.available_countries.size > 1 -%}
  {%- liquid
    assign id = 'country-' | append: id

    capture trigger_content
      if show_country_names
        assign label_structure = '<span class="localization-trigger-label__country-name t-overflow-ellipsis">[[cn]]</span> <span>([[ccic]] [[ccs]])</span>'
      else
        assign label_structure = '[[ccic]] [[ccs]]'
      endif

      echo label_structure | replace: '[[ccic]]', localization.country.currency.iso_code | replace: '[[ccs]]', localization.country.currency.symbol | replace: '[[cn]]', localization.country.name
    endcapture

    capture country_trigger
      if show_country_flags
        echo localization.country | image_url: width: 20 | image_tag
      endif

      echo trigger_structure | replace: '[[trigger_content]]', trigger_content
    endcapture
  -%}

  {%- capture country_drawer_content -%}
    {%- render 'modal-close-button',
      form_class: 'mobile-country-drawer__close-button'
    -%}

    <div class="mobile-country-drawer__content scrollbars-hidden" js-country-mobile-drawer>
      {% render 'localization-form-country',
        id: id,
        localization: localization,
        show_country_flags: show_country_flags,
        show_country_names: show_country_names,
        checkmark_icon: checkmark_icon,
        label_structure: label_structure
      %}
    </div>
  {%- endcapture -%}

  {%- render 'drawer',
    name: 'mobileCountryDrawer',
    content: country_drawer_content,
    alignment: 'bottom',
    class: 'country-drawer'
  -%}

  <button class="{{ trigger_classes }}" js-country-drawer-trigger>
    {{ country_trigger }}
  </button>
{%- endif -%}
